<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blog_by_Manu</title>
    <link rel="stylesheet" href="../files/uploader.css">
    <link rel="stylesheet" href="../files/font-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <p>Blog by Manush</p>
    </header>

    <form id="uploadForm">
        <input type="file" name="photos" id="photoInput" multiple required>
        <button type="submit">Upload</button>
    </form>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const fileInput = document.getElementById('photoInput');
            const files = fileInput.files;
            const token = prompt('Enter your GitHub token:');
            if (!token) {
                alert('GitHub token is required');
                return;
            }

            for (const file of files) {
                const reader = new FileReader();

                reader.onloadend = async () => {
                    const base64 = reader.result.split(',')[1];
                    const filename = file.name;

                    try {
                        const response = await fetch(`https://api.github.com/repos/manush888/Blog/contents/uploads/${filename}`, {
                            method: 'PUT',
                            headers: {
                                'Authorization': `token ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: `Add ${filename}`,
                                content: base64
                            })
                        });

                        if (response.ok) {
                            console.log(`Photo ${filename} uploaded successfully!`);
                        } else {
                            const errorData = await response.json();
                            console.error(`Failed to upload photo ${filename}. GitHub API responded with: ${errorData.message}`);
                        }
                    } catch (error) {
                        console.error(`Failed to upload photo ${filename} due to a network or fetch error.`, error);
                    }
                };

                reader.readAsDataURL(file);
            }

            alert('Photos uploaded successfully!');
        });
    </script>
</body>
</html>
